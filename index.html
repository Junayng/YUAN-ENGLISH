<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­é—¯å…³ä¹å›­</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* é˜²æ­¢åœ¨iPadä¸Šç‚¹å‡»è¿‡å¿«å¯¼è‡´é€‰ä¸­æ–‡å­— */
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(120deg, #4b6cb7, #182848);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            color: white;
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .game-container.active {
            display: flex;
        }

        .game-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .game-title {
            font-size: 1.8rem;
            color: #182848;
            margin-bottom: 5px;
        }

        .game-description {
            font-size: 1rem;
            color: #555;
            max-width: 700px;
            margin: 0 auto;
        }

        .game-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 100%;
            max-width: 800px;
        }

        /* æ¸¸æˆ1: å¤§å°å†™åŒ¹é… */
        .case-match-container {
            display: flex;
            justify-content: space-between;
            position: relative;
            min-height: 400px;
        }

        .letter-column {
            width: 40%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: space-around;
        }

        .letter-item {
            padding: 10px;
            border-radius: 15px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #f0f5ff;
            border: 2px solid #e0e6f0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: relative;
            z-index: 2;
        }

        .letter-item:active, .letter-item.selected {
            transform: scale(0.95);
            background: #e6f0ff;
            border-color: #4b6cb7;
        }

        .letter-item.matched {
            background: #e6f9e6;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .letter-item.wrong {
            animation: shake 0.5s;
            border-color: #f44336;
            color: #d32f2f;
        }

        #lines-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* æ¸¸æˆ2: ä¸­è‹±æ¶ˆæ¶ˆä¹ */
        .word-match-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* é»˜è®¤4åˆ— */
            gap: 10px;
            width: 100%;
        }

        .word-item {
            aspect-ratio: 1.5; /* ä¿æŒå®½é«˜æ¯” */
            padding: 5px;
            border-radius: 12px;
            font-size: 1.1rem;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
            background: #f0f5ff;
            border: 2px solid #e0e6f0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
        }

        .word-item.selected {
            background: #dbeafe;
            border-color: #2563eb;
            transform: scale(0.95);
        }

        .word-item.matched {
            background: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
        }

        .word-item.hidden {
            visibility: hidden; /* å…³é”®ä¿®æ”¹ï¼šå ä½ä½†ä¸æ˜¾ç¤º */
            pointer-events: none;
        }

        .word-item.wrong {
            background: #fee2e2;
            border-color: #ef4444;
            animation: shake 0.5s;
        }

        /* æ¸¸æˆ3: å•è¯åˆ†ç±» */
        .category-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 10px;
        }

        .category-box {
            flex: 1;
            padding: 10px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f0f5ff;
            border: 3px dashed #e0e6f0; /* è™šçº¿æ¡†è¡¨ç¤ºå¯æ”¾å…¥ */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 120px;
        }

        .category-box.active-target {
            border-color: #4b6cb7;
            background-color: #eef2ff;
            transform: scale(1.02);
        }

        .category-box i {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: block;
        }

        .category-box.animal { color: #e11d48; border-color: #fca5a5; }
        .category-box.number { color: #0284c7; border-color: #7dd3fc; }
        .category-box.stationery { color: #d97706; border-color: #fcd34d; }

        .category-words {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            width: 100%;
            margin-top: 10px;
        }

        .category-word {
            padding: 4px 8px;
            border-radius: 8px;
            background: white;
            font-size: 0.8rem;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .words-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* æ‰‹æœºä¸Š3åˆ— */
            gap: 10px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 15px;
            min-height: 150px;
        }

        .word-card {
            padding: 15px 5px;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            background: white;
            border: 2px solid #cbd5e1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }

        .word-card.selected {
            border-color: #4b6cb7;
            background-color: #e0e7ff;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(75, 108, 183, 0.3);
            z-index: 10;
        }

        /* æç¤ºæ¡† */
        .result-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            display: none;
            z-index: 2000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            70% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .result-box.success { background: rgba(34, 197, 94, 0.95); }
        .result-box.error { background: rgba(239, 68, 68, 0.95); }

        /* åº•éƒ¨è¿›åº¦æ¡ */
        .game-progress {
            margin-bottom: 20px;
            text-align: center;
        }
        .progress-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            width: 90%;
            margin: 5px auto;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #4b6cb7;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* æ–°å¢ï¼šæ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .restart-btn {
            background: #4caf50;
            color: white;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        .restart-btn:hover {
            background: #43a047;
            transform: translateY(-2px);
        }
        
        .level-btn {
            background: #ff9800;
            color: white;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }
        
        .level-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }
        
        /* å…³å¡é€‰æ‹©å¼¹çª— */
        .level-selector {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            justify-content: center;
            align-items: center;
        }
        
        .level-selector-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            animation: popIn 0.3s ease-out;
        }
        
        .level-selector h2 {
            color: #182848;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .level-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }
        
        .level-select-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .level-select-btn.active {
            background: #4b6cb7;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(75, 108, 183, 0.5);
        }
        
        .level-select-btn:not(.active) {
            background: #f0f5ff;
            color: #4b6cb7;
            border: 2px solid #4b6cb7;
        }
        
        .level-select-btn:not(.active):hover {
            background: #e0e7ff;
            transform: translateY(-3px);
        }
        
        .close-selector {
            padding: 10px 25px;
            background: #e0e6f0;
            color: #333;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .close-selector:hover {
            background: #d1d9e6;
        }

        /* åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* iPad/æ‰‹æœº å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .container { padding: 10px; }
            
            /* æ¸¸æˆ1 */
            .case-match-container { flex-direction: row; min-height: 350px; }
            .letter-item { padding: 8px; font-size: 1.5rem; }

            /* æ¸¸æˆ2 */
            .word-match-container { grid-template-columns: repeat(3, 1fr); }
            .word-item { font-size: 1rem; padding: 5px; }

            /* æ¸¸æˆ3 */
            .category-container { flex-direction: row; flex-wrap: wrap; }
            .category-box { min-width: 30%; font-size: 0.9rem; }
            .words-container { grid-template-columns: repeat(3, 1fr); }
            
            /* æç¤ºæ¡†é€‚é… */
            .result-box { font-size: 1.2rem; padding: 15px 30px; }
            
            /* æ§åˆ¶æŒ‰é’®é€‚é… */
            .control-btn { padding: 10px 20px; font-size: 0.9rem; }
            .level-select-btn { width: 60px; height: 60px; font-size: 1.3rem; }
        }

        /* çƒŸèŠ±ä¸æ­å–œç•Œé¢ */
        #fireworks {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 999; display: none;
        }
        .firework {
            position: absolute; width: 6px; height: 6px; border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }
        
        /* æ›´ä¸°å¯Œçš„çƒŸèŠ±æ•ˆæœ */
        .firework-circle {
            position: absolute; border-radius: 50%;
            animation: explodeCircle 1.2s ease-out forwards;
        }
        
        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }
        
        @keyframes explodeCircle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(180deg); opacity: 0; }
        }
        
        #congrats {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 1000;
            flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        #congrats h1 { color: #4b6cb7; font-size: 2.5rem; }
        #congrats button {
            margin-top: 30px; padding: 12px 30px; font-size: 1.2rem;
            background: #4b6cb7; color: white; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px 15px rgba(75, 108, 183, 0.4);
        }
        
        /* æ–°å¢ï¼šç»Ÿè®¡ä¿¡æ¯æ ·å¼ */
        .stats-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px auto;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-label {
            font-weight: bold;
            color: #555;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .stat-value.correct { color: #4caf50; }
        .stat-value.accuracy { color: #4b6cb7; }
        .stat-value.time { color: #ff9800; }
        
        /* æ–°å¢ï¼šè¯„ä»·æ ‡ç­¾æ ·å¼ */
        .evaluation-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 15px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .evaluation-perfect {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            border: 3px solid #a5d6a7;
        }
        
        .evaluation-good {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: 3px solid #ffcc80;
        }
        
        .evaluation-ok {
            background: linear-gradient(135deg, #2196f3, #1565c0);
            color: white;
            border: 3px solid #90caf9;
        }
        
        /* æ–°å¢ï¼šæœªå®Œæˆæç¤ºæ ·å¼ */
        .incomplete-message {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px auto;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .incomplete-message h2 {
            color: #f44336;
            margin-bottom: 15px;
        }
        
        .incomplete-message p {
            color: #555;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .incomplete-message .level-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .incomplete-message .level-badge {
            padding: 8px 15px;
            border-radius: 8px;
            background: #f0f5ff;
            color: #4b6cb7;
            font-weight: bold;
            border: 2px solid #4b6cb7;
        }
        
        .incomplete-message .level-badge.completed {
            background: #e6f9e6;
            color: #2e7d32;
            border-color: #4caf50;
        }
        
        /* éŸ³æ•ˆçŠ¶æ€æ˜¾ç¤º */
        .audio-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #4b6cb7;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <header>
            <h1><i class="fas fa-gamepad"></i> è‹±è¯­é—¯å…³</h1>
            <div class="game-progress">
                <div>Level <span id="currentLevel">1</span> / 3</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </header>

        <!-- æ–°å¢ï¼šæ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div class="control-panel">
            <button class="control-btn restart-btn" id="restartBtn">
                <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
            </button>
            <button class="control-btn level-btn" id="levelSelectBtn">
                <i class="fas fa-list-ol"></i> é€‰æ‹©å…³å¡
            </button>
        </div>

        <div class="game-container active" id="game1">
            <div class="game-header">
                <h2 class="game-title">1. å¤§å°å†™é…å¯¹</h2>
                <p class="game-description">ç‚¹å‡»å¤§å†™å­—æ¯ï¼Œå†ç‚¹å‡»å¯¹åº”çš„å°å†™å­—æ¯ã€‚</p>
            </div>
            <div class="game-content">
                <div class="case-match-container">
                    <div class="letter-column" id="uppercaseColumn"></div>
                    <div class="letter-column" id="lowercaseColumn"></div>
                    <svg id="lines-svg"></svg>
                </div>
            </div>
        </div>

        <div class="game-container" id="game2">
            <div class="game-header">
                <h2 class="game-title">2. ä¸­è‹±æ¶ˆæ¶ˆä¹</h2>
                <p class="game-description">ç‚¹å‡»ä¸­æ–‡å’Œå¯¹åº”çš„è‹±æ–‡å•è¯è¿›è¡Œæ¶ˆé™¤ã€‚</p>
            </div>
            <div class="game-content">
                <div class="word-match-container" id="wordMatchContainer"></div>
            </div>
        </div>

        <div class="game-container" id="game3">
            <div class="game-header">
                <h2 class="game-title">3. å•è¯åˆ†ç±»</h2>
                <p class="game-description">å…ˆç‚¹å‡»ä¸‹æ–¹çš„å•è¯é€‰ä¸­ï¼Œå†ç‚¹å‡»ä¸Šæ–¹çš„åˆ†ç±»æ¡†æ”¾å…¥ã€‚</p>
            </div>
            <div class="game-content">
                <div class="category-container">
                    <div class="category-box animal" data-category="animal">
                        <i class="fas fa-paw"></i> åŠ¨ç‰©
                        <div class="category-words"></div>
                    </div>
                    <div class="category-box number" data-category="number">
                        <i class="fas fa-hashtag"></i> æ•°å­—
                        <div class="category-words"></div>
                    </div>
                    <div class="category-box stationery" data-category="stationery">
                        <i class="fas fa-pen-ruler"></i> æ–‡å…·
                        <div class="category-words"></div>
                    </div>
                </div>
                <div class="words-container" id="wordsContainer">
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šå…³å¡é€‰æ‹©å¼¹çª— -->
    <div class="level-selector" id="levelSelector">
        <div class="level-selector-content">
            <h2><i class="fas fa-map-signs"></i> é€‰æ‹©å…³å¡</h2>
            <p>è¯·é€‰æ‹©ä½ æƒ³è¦æŒ‘æˆ˜çš„å…³å¡ï¼š</p>
            
            <div class="level-buttons">
                <button class="level-select-btn" data-level="1">1</button>
                <button class="level-select-btn" data-level="2">2</button>
                <button class="level-select-btn" data-level="3">3</button>
            </div>
            
            <div class="level-descriptions">
                <p style="margin: 10px 0; color: #666; font-size: 0.9rem;">
                    <strong>å…³å¡1:</strong> å¤§å°å†™é…å¯¹ - åŒ¹é…å¤§å†™å’Œå°å†™å­—æ¯<br>
                    <strong>å…³å¡2:</strong> ä¸­è‹±æ¶ˆæ¶ˆä¹ - åŒ¹é…ä¸­æ–‡å’Œè‹±æ–‡å•è¯<br>
                    <strong>å…³å¡3:</strong> å•è¯åˆ†ç±» - å°†å•è¯åˆ†ç±»åˆ°æ­£ç¡®çš„ç±»åˆ«
                </p>
            </div>
            
            <button class="close-selector" id="closeSelector">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="result-box" id="resultBox"></div>
    <div id="fireworks"></div>
    <div id="congrats">
        <!-- å®Œæˆæµ‹è¯•çš„ç•Œé¢ -->
        <div id="completeContent" style="display: none;">
            <h1>ğŸ‰ æ­å–œä½ é—¯å…³æˆåŠŸï¼</h1>
            <div id="evaluationBadge" class="evaluation-badge"></div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯å±•ç¤º -->
            <div class="stats-container" id="statsContainer">
                <h2 style="color: #4b6cb7; margin-bottom: 20px; text-align: center;">æµ‹è¯„ç»“æœ</h2>
                <div class="stats-row">
                    <span class="stat-label">æ€»é¢˜æ•°ï¼š</span>
                    <span class="stat-value" id="totalQuestions">0</span>
                </div>
                <div class="stats-row">
                    <span class="stat-label">æ­£ç¡®æ•°ï¼š</span>
                    <span class="stat-value correct" id="correctCount">0</span>
                </div>
                <div class="stats-row">
                    <span class="stat-label">é”™è¯¯æ•°ï¼š</span>
                    <span class="stat-value" style="color: #f44336;" id="errorCount">0</span>
                </div>
                <div class="stats-row">
                    <span class="stat-label">æ­£ç¡®ç‡ï¼š</span>
                    <span class="stat-value accuracy" id="accuracyRate">0%</span>
                </div>
                <div class="stats-row">
                    <span class="stat-label">ç­”é¢˜æ—¶é—´ï¼š</span>
                    <span class="stat-value time" id="timeSpent">0ç§’</span>
                </div>
            </div>
            
            <button onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        </div>
        
        <!-- æœªå®Œæˆæµ‹è¯•çš„ç•Œé¢ -->
        <div id="incompleteContent" style="display: none;">
            <div class="incomplete-message">
                <h2><i class="fas fa-exclamation-triangle"></i> ä½ è¿˜æ²¡æœ‰å®Œæˆæµ‹è¯•å“¦</h2>
                <p>è¯·å®Œæˆæ‰€æœ‰å…³å¡åæ‰èƒ½æŸ¥çœ‹æœ€ç»ˆç»“æœã€‚</p>
                
                <div id="levelCompletionStatus" class="level-list">
                    <!-- è¿™é‡Œä¼šåŠ¨æ€æ˜¾ç¤ºå…³å¡å®ŒæˆçŠ¶æ€ -->
                </div>
                
                <p>è¯·è¿”å›ç»§ç»­å®Œæˆæœªå®Œæˆçš„å…³å¡ã€‚</p>
                
                <div style="display: flex; gap: 15px; margin-top: 20px; justify-content: center;">
                    <button onclick="showGame()" style="padding: 10px 25px; background: #4b6cb7; color: white; border: none; border-radius: 50px; cursor: pointer;">
                        è¿”å›æ¸¸æˆ
                    </button>
                    <button onclick="location.reload()" style="padding: 10px 25px; background: #e0e6f0; color: #333; border: none; border-radius: 50px; cursor: pointer;">
                        é‡æ–°å¼€å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³æ•ˆçŠ¶æ€æç¤º -->
    <div class="audio-status" id="audioStatus">
        <i class="fas fa-volume-up"></i> éŸ³æ•ˆå·²å¼€å¯
    </div>

    <script>
        // æ–°å¢ï¼šæµ‹è¯„ç»Ÿè®¡å¯¹è±¡
        const TestStats = {
            startTime: null,
            totalQuestions: 0,
            correctCount: 0,
            errorCount: 0,
            // è®°å½•æ¯ä¸ªå…³å¡çš„å®ŒæˆçŠ¶æ€
            levelCompletion: {
                1: { completed: false, total: 5, completedCount: 0 },
                2: { completed: false, total: 6, completedCount: 0 },
                3: { completed: false, total: 12, completedCount: 0 }
            },
            // è®°å½•æ¯é“é¢˜æ˜¯å¦å·²ç»ç­”å¯¹è¿‡ï¼ˆé˜²æ­¢é‡å¤è®¡æ•°ï¼‰
            questionStatus: new Map(),
            
            init: function() {
                this.startTime = Date.now();
                this.totalQuestions = 0;
                this.correctCount = 0;
                this.errorCount = 0;
                this.questionStatus.clear();
                
                // é‡ç½®å…³å¡å®ŒæˆçŠ¶æ€
                for (let level in this.levelCompletion) {
                    this.levelCompletion[level].completed = false;
                    this.levelCompletion[level].completedCount = 0;
                }
                
                // è®¡ç®—æ€»é¢˜æ•°ï¼šæ¸¸æˆ1(5é¢˜) + æ¸¸æˆ2(6é¢˜) + æ¸¸æˆ3(12é¢˜)
                this.totalQuestions = 5 + 6 + 12;
            },
            
            recordAttempt: function(questionId, isCorrect) {
                // å¦‚æœè¿™é“é¢˜ä¹‹å‰å·²ç»ç­”å¯¹è¿‡ï¼Œä¸å†é‡å¤è®°å½•
                if (this.questionStatus.has(questionId) && this.questionStatus.get(questionId) === true) {
                    return;
                }
                
                if (isCorrect) {
                    this.correctCount++;
                    this.questionStatus.set(questionId, true);
                    
                    // å¦‚æœä¹‹å‰æœ‰é”™è¯¯è®°å½•ï¼Œéœ€è¦å‡å°‘é”™è¯¯è®¡æ•°
                    if (this.questionStatus.get(questionId) === false) {
                        this.errorCount = Math.max(0, this.errorCount - 1);
                    }
                } else {
                    // è®°å½•é”™è¯¯
                    this.errorCount++;
                    this.questionStatus.set(questionId, false);
                }
            },
            
            updateLevelCompletion: function(level, completedCount) {
                if (this.levelCompletion[level]) {
                    this.levelCompletion[level].completedCount = completedCount;
                    this.levelCompletion[level].completed = (completedCount >= this.levelCompletion[level].total);
                }
            },
            
            isAllLevelsCompleted: function() {
                for (let level in this.levelCompletion) {
                    if (!this.levelCompletion[level].completed) {
                        return false;
                    }
                }
                return true;
            },
            
            getTimeSpent: function() {
                if (!this.startTime) return 0;
                const seconds = Math.floor((Date.now() - this.startTime) / 1000);
                return seconds;
            },
            
            getAccuracy: function() {
                if (this.totalQuestions === 0) return 0;
                return Math.round((this.correctCount / this.totalQuestions) * 100);
            },
            
            getEvaluation: function() {
                const errorCount = this.errorCount;
                if (errorCount <= 3) {
                    return { text: "Perfect!", type: "perfect", class: "evaluation-perfect" };
                } else if (errorCount <= 7) {
                    return { text: "Good!", type: "good", class: "evaluation-good" };
                } else {
                    return { text: "OK!", type: "ok", class: "evaluation-ok" };
                }
            },
            
            displayStats: function() {
                const timeSpent = this.getTimeSpent();
                const accuracy = this.getAccuracy();
                const evaluation = this.getEvaluation();
                
                document.getElementById('totalQuestions').textContent = this.totalQuestions;
                document.getElementById('correctCount').textContent = this.correctCount;
                document.getElementById('errorCount').textContent = this.errorCount;
                document.getElementById('accuracyRate').textContent = accuracy + '%';
                document.getElementById('timeSpent').textContent = timeSpent + 'ç§’';
                
                // æ˜¾ç¤ºè¯„ä»·
                const badge = document.getElementById('evaluationBadge');
                badge.textContent = evaluation.text;
                badge.className = `evaluation-badge ${evaluation.class}`;
            },
            
            reset: function() {
                this.init();
            },
            
            getCompletionStatusHTML: function() {
                let html = '';
                for (let level in this.levelCompletion) {
                    const levelData = this.levelCompletion[level];
                    const completed = levelData.completed;
                    const progress = levelData.completedCount;
                    const total = levelData.total;
                    
                    html += `<div class="level-badge ${completed ? 'completed' : ''}">`;
                    html += `å…³å¡${level}: ${progress}/${total}`;
                    html += completed ? ' âœ“' : ' ...';
                    html += '</div>';
                }
                return html;
            }
        };

        // éŸ³é¢‘ç®¡ç†å™¨
        const AudioManager = {
            successAudio: null,
            errorAudio: null,
            levelCompleteAudio: null,
            fireworksAudio: null,
            isAudioEnabled: true,
            
            init: function() {
                try {
                    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå…¼å®¹æ€§å¤„ç†ï¼‰
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        this.audioContext = new AudioContext();
                        
                        // æˆåŠŸéŸ³æ•ˆ - çŸ­ä¿ƒæ¬¢å¿«çš„éŸ³è°ƒ
                        this.successAudio = this.createSuccessTone();
                        
                        // é”™è¯¯éŸ³æ•ˆ - ä½æ²‰æç¤ºéŸ³
                        this.errorAudio = this.createErrorTone();
                        
                        // å…³å¡å®ŒæˆéŸ³æ•ˆ - èƒœåˆ©éŸ³æ•ˆ
                        this.levelCompleteAudio = this.createLevelCompleteTone();
                        
                        // çƒŸèŠ±éŸ³æ•ˆ - è¿ç»­çš„åº†ç¥éŸ³
                        this.fireworksAudio = this.createFireworksTone();
                        
                        console.log("éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ");
                    } else {
                        console.warn("æµè§ˆå™¨ä¸æ”¯æŒWeb Audio APIï¼Œå°†ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ");
                        this.useFallbackAudio();
                    }
                } catch (e) {
                    console.error("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:", e);
                    this.useFallbackAudio();
                }
                
                // æ£€æµ‹ç”¨æˆ·äº¤äº’ä»¥è§£é”éŸ³é¢‘ï¼ˆiOSç­‰æµè§ˆå™¨è¦æ±‚ï¼‰
                document.addEventListener('click', () => {
                    if (this.audioContext && this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                }, { once: true });
            },
            
            createSuccessTone: function() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, this.audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, this.audioContext.currentTime + 0.1); // E5
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.5);
                
                return { oscillator, gainNode };
            },
            
            createErrorTone: function() {
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(220, this.audioContext.currentTime); // A3
                oscillator.frequency.setValueAtTime(196, this.audioContext.currentTime + 0.2); // G3
                
                gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.4);
                
                oscillator.type = 'sine';
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.4);
                
                return { oscillator, gainNode };
            },
            
            createLevelCompleteTone: function() {
                // åˆ›å»ºä¸€ä¸ªæ›´å¤æ‚çš„èƒœåˆ©éŸ³æ•ˆ
                const now = this.audioContext.currentTime;
                const mainOsc = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                mainOsc.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                // æ’­æ”¾ä¸€ä¸ªä¸Šå‡çš„éŸ³é˜¶
                mainOsc.frequency.setValueAtTime(392, now); // G4
                mainOsc.frequency.setValueAtTime(523.25, now + 0.2); // C5
                mainOsc.frequency.setValueAtTime(659.25, now + 0.4); // E5
                mainOsc.frequency.setValueAtTime(783.99, now + 0.6); // G5
                
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.3, now + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 1.0);
                
                mainOsc.start();
                mainOsc.stop(now + 1.0);
                
                return { mainOsc, gainNode };
            },
            
            createFireworksTone: function() {
                // çƒŸèŠ±æ•ˆæœéŸ³ - å¤šä¸ªå¿«é€ŸéŸ³è°ƒ
                const now = this.audioContext.currentTime;
                
                // åˆ›å»ºå¤šä¸ªçƒŸèŠ±éŸ³æ•ˆ
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const osc = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        osc.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        // éšæœºéŸ³é«˜
                        const freq = 300 + Math.random() * 500;
                        osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                        
                        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                        
                        osc.start();
                        osc.stop(this.audioContext.currentTime + 0.3);
                    }, i * 100);
                }
            },
            
            useFallbackAudio: function() {
                // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ç®€å•çš„HTML5 Audioï¼ˆéœ€è¦éŸ³é¢‘æ–‡ä»¶ï¼‰
                // è¿™é‡Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨Web Audio APIï¼Œå› ä¸ºå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ
                console.log("ä½¿ç”¨å¤‡ç”¨éŸ³é¢‘æ–¹æ¡ˆ");
            },
            
            playSuccess: function() {
                if (!this.isAudioEnabled) return;
                try {
                    this.createSuccessTone();
                } catch (e) {
                    console.warn("æ’­æ”¾æˆåŠŸéŸ³æ•ˆå¤±è´¥:", e);
                }
            },
            
            playError: function() {
                if (!this.isAudioEnabled) return;
                try {
                    this.createErrorTone();
                } catch (e) {
                    console.warn("æ’­æ”¾é”™è¯¯éŸ³æ•ˆå¤±è´¥:", e);
                }
            },
            
            playLevelComplete: function() {
                if (!this.isAudioEnabled) return;
                try {
                    this.createLevelCompleteTone();
                } catch (e) {
                    console.warn("æ’­æ”¾å…³å¡å®ŒæˆéŸ³æ•ˆå¤±è´¥:", e);
                }
            },
            
            playFireworks: function() {
                if (!this.isAudioEnabled) return;
                try {
                    this.createFireworksTone();
                } catch (e) {
                    console.warn("æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆå¤±è´¥:", e);
                }
            },
            
            toggleAudio: function() {
                this.isAudioEnabled = !this.isAudioEnabled;
                const statusEl = document.getElementById('audioStatus');
                if (this.isAudioEnabled) {
                    statusEl.innerHTML = '<i class="fas fa-volume-up"></i> éŸ³æ•ˆå·²å¼€å¯';
                    statusEl.style.color = '#4b6cb7';
                } else {
                    statusEl.innerHTML = '<i class="fas fa-volume-mute"></i> éŸ³æ•ˆå·²å…³é—­';
                    statusEl.style.color = '#666';
                }
            }
        };

        // æ•°æ®é…ç½®
        let currentLevel = 1;
        const totalLevels = 3;
        let selectedItem = null; // é€šç”¨é€‰ä¸­å˜é‡

        const wordLibrary = {
            animal: [
                { en: 'dog', cn: 'ç‹—' }, { en: 'cat', cn: 'çŒ«' },
                { en: 'bird', cn: 'é¸Ÿ' }, { en: 'horse', cn: 'é©¬' },
                { en: 'bee', cn: 'èœœèœ‚' }, { en: 'hen', cn: 'æ¯é¸¡' }
            ],
            number: [
                { en: 'one', cn: 'ä¸€' }, { en: 'two', cn: 'äºŒ' },
                { en: 'three', cn: 'ä¸‰' }, { en: 'four', cn: 'å››' },
                { en: 'five', cn: 'äº”' }, { en: 'six', cn: 'å…­' }
            ],
            stationery: [
                { en: 'pencil case', cn: 'é“…ç¬”ç›’' }, { en: 'book', cn: 'ä¹¦' },
                { en: 'ruler', cn: 'å°ºå­' }, { en: 'eraser', cn: 'æ©¡çš®' }
            ]
        };
        const allWords = [...wordLibrary.animal, ...wordLibrary.number, ...wordLibrary.stationery];

        // å·¥å…·å‡½æ•°
        function showResult(msg, type) {
            const box = document.getElementById('resultBox');
            box.textContent = msg;
            box.className = `result-box ${type}`;
            box.style.display = 'block';
            
            // æ’­æ”¾å¯¹åº”çš„éŸ³æ•ˆ
            if (type === 'success') {
                AudioManager.playSuccess();
            } else if (type === 'error') {
                AudioManager.playError();
            }
            
            setTimeout(() => box.style.display = 'none', 1000);
        }

        function updateProgress() {
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('progressFill').style.width = `${((currentLevel-1)/totalLevels)*100}%`;
            
            // æ›´æ–°å…³å¡é€‰æ‹©æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.level-select-btn').forEach(btn => {
                const level = parseInt(btn.dataset.level);
                if (level === currentLevel) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function switchLevel(level) {
            if (level < 1 || level > totalLevels) return;
            
            // æ¸…ç†ä¸Šä¸€å…³çš„é€‰ä¸­çŠ¶æ€
            selectedItem = null;
            document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));

            // å…³é—­å…³å¡é€‰æ‹©å¼¹çª—
            document.getElementById('levelSelector').style.display = 'none';

            setTimeout(() => {
                document.querySelectorAll('.game-container').forEach(el => el.classList.remove('active'));
                const nextGame = document.getElementById(`game${level}`);
                if(nextGame) {
                    nextGame.classList.add('active');
                    currentLevel = level;
                    updateProgress();
                    // é‡æ–°ç»˜åˆ¶è¿çº¿æˆ–å¸ƒå±€ï¼ˆè§£å†³éšè—æ˜¾ç¤ºå¯èƒ½å¯¼è‡´çš„æ¸²æŸ“é—®é¢˜ï¼‰
                    if(level === 1) initGame1(); 
                    if(level === 2) initGame2();
                    if(level === 3) initGame3();
                }
            }, 300);
        }

        // é‡æ–°å¼€å§‹å½“å‰å…³å¡
        function restartCurrentLevel() {
            // é‡ç½®ç»Ÿè®¡ä¿¡æ¯ï¼ˆä»…å½“å‰å…³å¡ï¼‰
            TestStats.levelCompletion[currentLevel].completed = false;
            TestStats.levelCompletion[currentLevel].completedCount = 0;
            
            // é‡æ–°åˆå§‹åŒ–å½“å‰å…³å¡
            switchLevel(currentLevel);
            
            // æ˜¾ç¤ºæç¤º
            showResult(`é‡æ–°å¼€å§‹å…³å¡${currentLevel}`, 'success');
        }

        // çƒŸèŠ±ç‰¹æ•ˆ - å¢å¼ºç‰ˆ
        function triggerConfetti() {
            const fw = document.getElementById('fireworks');
            fw.style.display = 'block';
            
            // æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆ
            AudioManager.playFireworks();
            
            // åˆ›å»ºæ›´å¤šæ ·å¼çš„çƒŸèŠ±
            for(let i=0; i<80; i++) {
                setTimeout(() => {
                    // éšæœºé€‰æ‹©çƒŸèŠ±ç±»å‹
                    if (Math.random() > 0.5) {
                        // åœ†å½¢çƒŸèŠ±
                        const p = document.createElement('div');
                        p.className = 'firework';
                        p.style.left = Math.random()*100 + '%';
                        p.style.top = Math.random()*80 + '%';
                        p.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
                        p.style.width = Math.random()*8 + 4 + 'px';
                        p.style.height = p.style.width;
                        fw.appendChild(p);
                        p.addEventListener('animationend', () => p.remove());
                    } else {
                        // ç¯å½¢çƒŸèŠ±
                        const circle = document.createElement('div');
                        circle.className = 'firework-circle';
                        circle.style.left = Math.random()*100 + '%';
                        circle.style.top = Math.random()*80 + '%';
                        circle.style.border = `2px solid hsl(${Math.random()*360}, 100%, 50%)`;
                        circle.style.width = Math.random()*30 + 10 + 'px';
                        circle.style.height = circle.style.width;
                        fw.appendChild(circle);
                        circle.addEventListener('animationend', () => circle.remove());
                    }
                }, i * 40);
            }
            setTimeout(() => fw.style.display = 'none', 3000);
        }

        function checkLevelComplete(gameId, current, target) {
            // æ›´æ–°å…³å¡å®Œæˆè¿›åº¦
            const level = parseInt(gameId.replace('game', ''));
            TestStats.updateLevelCompletion(level, current);
            
            if(current === target) {
                showResult('æ­å–œé€šå…³ï¼', 'success');
                
                // æ’­æ”¾å…³å¡å®ŒæˆéŸ³æ•ˆ
                AudioManager.playLevelComplete();
                
                // è§¦å‘çƒŸèŠ±æ•ˆæœ
                triggerConfetti();
                
                if(currentLevel < totalLevels) {
                    setTimeout(() => switchLevel(currentLevel + 1), 1500);
                } else {
                    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…³å¡éƒ½å®Œæˆäº†
                    setTimeout(() => {
                        const allCompleted = TestStats.isAllLevelsCompleted();
                        
                        if (allCompleted) {
                            // æ‰€æœ‰å…³å¡éƒ½å®Œæˆäº†ï¼Œæ˜¾ç¤ºå®Œæˆç•Œé¢
                            TestStats.displayStats();
                            document.getElementById('completeContent').style.display = 'block';
                            document.getElementById('incompleteContent').style.display = 'none';
                            document.getElementById('mainContainer').style.display = 'none';
                            document.getElementById('congrats').style.display = 'flex';
                        } else {
                            // æœ‰æœªå®Œæˆçš„å…³å¡ï¼Œæ˜¾ç¤ºæœªå®Œæˆç•Œé¢
                            showIncompleteMessage();
                        }
                    }, 1500);
                }
            }
        }

        // æ˜¾ç¤ºæœªå®Œæˆæ¶ˆæ¯
        function showIncompleteMessage() {
            // æ›´æ–°å…³å¡å®ŒæˆçŠ¶æ€æ˜¾ç¤º
            document.getElementById('levelCompletionStatus').innerHTML = TestStats.getCompletionStatusHTML();
            
            // æ˜¾ç¤ºæœªå®Œæˆç•Œé¢
            document.getElementById('completeContent').style.display = 'none';
            document.getElementById('incompleteContent').style.display = 'block';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('congrats').style.display = 'flex';
        }

        // è¿”å›æ¸¸æˆç•Œé¢
        function showGame() {
            document.getElementById('congrats').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
        }

        // --- æ¸¸æˆ 1: è¿çº¿ ---
        function initGame1() {
            const letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ'.split(''); // å»æ‰å®¹æ˜“æ··æ·†çš„I,O
            const picked = letters.sort(() => 0.5 - Math.random()).slice(0, 5);
            
            const upCol = document.getElementById('uppercaseColumn');
            const lowCol = document.getElementById('lowercaseColumn');
            const svg = document.getElementById('lines-svg');
            
            upCol.innerHTML = ''; lowCol.innerHTML = ''; svg.innerHTML = '';
            
            picked.forEach(l => {
                const div = document.createElement('div');
                div.className = 'letter-item';
                div.textContent = l;
                div.dataset.val = l;
                div.dataset.type = 'upper';
                upCol.appendChild(div);
            });

            const shuffledLow = [...picked].sort(() => 0.5 - Math.random());
            shuffledLow.forEach(l => {
                const div = document.createElement('div');
                div.className = 'letter-item';
                div.textContent = l.toLowerCase();
                div.dataset.val = l;
                div.dataset.type = 'lower';
                lowCol.appendChild(div);
            });

            let matchedCount = 0;
            const items = document.querySelectorAll('#game1 .letter-item');
            
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if(this.classList.contains('matched')) return;

                    // å–æ¶ˆåŒä¾§çš„é€‰ä¸­
                    items.forEach(i => {
                        if(i !== this && i.dataset.type === this.dataset.type) i.classList.remove('selected');
                    });
                    this.classList.add('selected');

                    const otherSelected = Array.from(items).find(i => i !== this && i.classList.contains('selected') && i.dataset.type !== this.dataset.type);

                    if(otherSelected) {
                        if(this.dataset.val === otherSelected.dataset.val) {
                            // åŒ¹é…æˆåŠŸ - è®°å½•æ­£ç¡®
                            TestStats.recordAttempt(`game1_${this.dataset.val}`, true);
                            
                            this.classList.remove('selected'); otherSelected.classList.remove('selected');
                            this.classList.add('matched'); otherSelected.classList.add('matched');
                            showResult('Good!', 'success');
                            drawLine(this, otherSelected, svg);
                            matchedCount++;
                            checkLevelComplete('game1', matchedCount, 5);
                        } else {
                            // åŒ¹é…å¤±è´¥ - è®°å½•é”™è¯¯
                            TestStats.recordAttempt(`game1_${this.dataset.val}`, false);
                            TestStats.recordAttempt(`game1_${otherSelected.dataset.val}`, false);
                            
                            this.classList.add('wrong'); otherSelected.classList.add('wrong');
                            showResult('å†ä»”ç»†æƒ³æƒ³å™¢ï¼', 'error');
                            setTimeout(() => {
                                this.classList.remove('wrong', 'selected');
                                otherSelected.classList.remove('wrong', 'selected');
                            }, 500);
                        }
                    }
                });
            });
        }

        function drawLine(el1, el2, svg) {
            const r1 = el1.getBoundingClientRect();
            const r2 = el2.getBoundingClientRect();
            const cR = document.querySelector('.case-match-container').getBoundingClientRect();
            
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            // ç®€å•çš„åæ ‡è®¡ç®—
            line.setAttribute('x1', r1.left + r1.width/2 - cR.left);
            line.setAttribute('y1', r1.top + r1.height/2 - cR.top);
            line.setAttribute('x2', r2.left + r2.width/2 - cR.left);
            line.setAttribute('x2', r2.left + r2.width/2 - cR.left);
            line.setAttribute('y2', r2.top + r2.height/2 - cR.top);
            line.setAttribute('stroke', '#4caf50');
            line.setAttribute('stroke-width', '3');
            svg.appendChild(line);
        }

        // --- æ¸¸æˆ 2: æ¶ˆæ¶ˆä¹ (ä¿®å¤éšè—é—®é¢˜) ---
        function initGame2() {
            const count = 6;
            const chosen = allWords.sort(() => 0.5 - Math.random()).slice(0, count);
            const container = document.getElementById('wordMatchContainer');
            container.innerHTML = '';

            let items = [];
            chosen.forEach(w => {
                items.push({ txt: w.en, match: w.cn, id: w.en });
                items.push({ txt: w.cn, match: w.en, id: w.en });
            });
            items.sort(() => 0.5 - Math.random());

            items.forEach(obj => {
                const div = document.createElement('div');
                div.className = 'word-item';
                div.textContent = obj.txt;
                div.dataset.match = obj.match;
                div.dataset.id = obj.id; // ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€å¯¹
                container.appendChild(div);
            });

            let matchedCount = 0;
            const wordItems = container.querySelectorAll('.word-item');
            let firstSelect = null;

            wordItems.forEach(item => {
                item.addEventListener('click', function() {
                    if(this.classList.contains('hidden') || this.classList.contains('matched')) return;

                    if(!firstSelect) {
                        firstSelect = this;
                        this.classList.add('selected');
                    } else if (firstSelect === this) {
                        this.classList.remove('selected');
                        firstSelect = null;
                    } else {
                        // åˆ¤æ–­æ˜¯å¦åŒ¹é…
                        if(this.dataset.match === firstSelect.textContent) {
                            // åŒ¹é…æˆåŠŸ - è®°å½•æ­£ç¡®
                            TestStats.recordAttempt(`game2_${this.dataset.id}`, true);
                            
                            this.classList.add('matched');
                            firstSelect.classList.add('matched');
                            showResult('Bingo!', 'success');
                            
                            const tempFirst = firstSelect;
                            const tempSecond = this;
                            
                            setTimeout(() => {
                                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨ visibility: hidden ä¿æŒå ä½
                                tempFirst.classList.remove('selected', 'matched');
                                tempSecond.classList.remove('selected', 'matched');
                                tempFirst.classList.add('hidden');
                                tempSecond.classList.add('hidden');
                            }, 500);

                            matchedCount++;
                            checkLevelComplete('game2', matchedCount, count);
                        } else {
                            // åŒ¹é…å¤±è´¥ - è®°å½•é”™è¯¯
                            TestStats.recordAttempt(`game2_${this.dataset.id}`, false);
                            TestStats.recordAttempt(`game2_${firstSelect.dataset.id}`, false);
                            
                            this.classList.add('wrong');
                            firstSelect.classList.add('wrong');
                            showResult('å†ä»”ç»†æƒ³æƒ³å™¢ï¼', 'error');
                            setTimeout(() => {
                                this.classList.remove('wrong');
                                if(firstSelect) firstSelect.classList.remove('wrong', 'selected');
                            }, 500);
                        }
                        firstSelect = null;
                    }
                });
            });
        }

        // --- æ¸¸æˆ 3: åˆ†ç±» (iPad å…¼å®¹: ç‚¹å‡»é€‰ä¸­ -> ç‚¹å‡»ç§»åŠ¨) ---
        function initGame3() {
            const countPerCat = 4;
            let list = [];
            ['animal', 'number', 'stationery'].forEach(cat => {
                const words = wordLibrary[cat].slice(0, countPerCat).map(w => ({...w, cat: cat}));
                list = list.concat(words);
            });
            list.sort(() => 0.5 - Math.random());

            const container = document.getElementById('wordsContainer');
            container.innerHTML = '';
            // æ¸…ç©ºä¸Šé¢çš„æ¡†
            document.querySelectorAll('.category-words').forEach(d => d.innerHTML = '');

            list.forEach(w => {
                const div = document.createElement('div');
                div.className = 'word-card';
                div.textContent = w.en;
                div.dataset.cat = w.cat;
                // PCç«¯ä¿ç•™æ‹–æ‹½å±æ€§ï¼Œè™½ç„¶iPadä¸»è¦é ç‚¹å‡»
                div.draggable = true;
                container.appendChild(div);
            });

            let activeCard = null;
            let matchedCount = 0;
            const total = list.length;

            // 1. å•è¯å¡ç‰‡ç‚¹å‡»é€»è¾‘
            const cards = container.querySelectorAll('.word-card');
            cards.forEach(card => {
                // ç‚¹å‡»é€‰ä¸­é€»è¾‘
                card.addEventListener('click', function() {
                    if(activeCard === this) {
                        this.classList.remove('selected');
                        activeCard = null;
                        return;
                    }
                    if(activeCard) activeCard.classList.remove('selected');
                    this.classList.add('selected');
                    activeCard = this;
                    // æ’­æ”¾ä¸€ä¸ªå¾®å°çš„éŸ³æ•ˆæˆ–éœ‡åŠ¨
                    if(navigator.vibrate) navigator.vibrate(10);
                });

                // æ‹–æ‹½é€»è¾‘ (PCè¾…åŠ©)
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text', card.textContent);
                    e.dataTransfer.setData('cat', card.dataset.cat);
                    activeCard = card; // æ‹–æ‹½æ—¶ä¹Ÿæ ‡è®°ä¸ºé€‰ä¸­
                });
            });

            // 2. ç›®æ ‡ç›’å­ç‚¹å‡»é€»è¾‘ (æ¥æ”¶)
            const targets = document.querySelectorAll('.category-box');
            targets.forEach(box => {
                // ç‚¹å‡»ç›’å­æ¥æ”¶é€‰ä¸­çš„å¡ç‰‡
                box.addEventListener('click', function() {
                    if(!activeCard) return;

                    const correctCat = this.dataset.category;
                    const cardCat = activeCard.dataset.cat;
                    
                    // è®°å½•ç­”é¢˜å°è¯•
                    TestStats.recordAttempt(`game3_${activeCard.textContent}`, correctCat === cardCat);

                    if(correctCat === cardCat) {
                        // ç§»åŠ¨å…ƒç´ 
                        const wordSpan = document.createElement('div');
                        wordSpan.className = 'category-word';
                        wordSpan.textContent = activeCard.textContent;
                        this.querySelector('.category-words').appendChild(wordSpan);
                        
                        activeCard.remove();
                        activeCard = null;
                        showResult('Correct!', 'success');
                        matchedCount++;
                        checkLevelComplete('game3', matchedCount, total);
                    } else {
                        // é”™è¯¯åˆ†ç±» - æ˜¾ç¤º"å†ä»”ç»†æƒ³æƒ³å™¢ï¼"
                        showResult('å†ä»”ç»†æƒ³æƒ³å™¢ï¼', 'error');
                        activeCard.classList.add('wrong'); // è¿™é‡Œçš„wrongæ ·å¼éœ€è‡ªè¡Œå®šä¹‰æˆ–å¤ç”¨
                        setTimeout(() => activeCard.classList.remove('wrong'), 500);
                    }
                });

                // æ‹–æ”¾æ¥æ”¶ (PCè¾…åŠ©)
                box.addEventListener('dragover', e => e.preventDefault());
                box.addEventListener('drop', e => {
                    e.preventDefault();
                    if(!activeCard) return; // ç®€å•æ ¡éªŒ
                    // è§¦å‘ç‚¹å‡»é€»è¾‘å¤ç”¨
                    box.click(); 
                });
            });
        }

        // åˆå§‹åŒ–æ§åˆ¶æŒ‰é’®äº‹ä»¶
        function initControls() {
            // é‡æ–°å¼€å§‹æŒ‰é’®
            document.getElementById('restartBtn').addEventListener('click', restartCurrentLevel);
            
            // é€‰æ‹©å…³å¡æŒ‰é’®
            document.getElementById('levelSelectBtn').addEventListener('click', () => {
                document.getElementById('levelSelector').style.display = 'flex';
            });
            
            // å…³é—­é€‰æ‹©å¼¹çª—
            document.getElementById('closeSelector').addEventListener('click', () => {
                document.getElementById('levelSelector').style.display = 'none';
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('levelSelector').addEventListener('click', (e) => {
                if (e.target === document.getElementById('levelSelector')) {
                    document.getElementById('levelSelector').style.display = 'none';
                }
            });
            
            // å…³å¡é€‰æ‹©æŒ‰é’®
            document.querySelectorAll('.level-select-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const level = parseInt(btn.dataset.level);
                    switchLevel(level);
                });
            });
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
            AudioManager.init();
            
            // åˆå§‹åŒ–æµ‹è¯„ç»Ÿè®¡
            TestStats.init();
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame1();
            initGame2();
            initGame3();
            
            // åˆå§‹åŒ–æ§åˆ¶æŒ‰é’®
            initControls();
            
            // æ›´æ–°è¿›åº¦æ¡åˆå§‹çŠ¶æ€
            updateProgress();
            
            // æ·»åŠ éŸ³æ•ˆå¼€å…³åŠŸèƒ½
            document.getElementById('audioStatus').addEventListener('click', () => {
                AudioManager.toggleAudio();
            });
        });

    </script>
</body>
</html>